smartRound (Умное округление / Significant Figures)
Обычный round убивает крипту. Если ты округлишь PEPE или SHIB до 2 знаков, получишь 0.00. Тебе нужно округление, которое зависит от цены.

Суть: Если число > 1, округляем до 2 знаков. Если число < 0.001, показываем 6-8 знаков.

Зачем: Чтобы цена Биткоина была 55,120.50, а цена PEPE 0.00000451 (а не 0.00).

Пример в шаблоне:

Handlebars

Цена Buy: {{smartRound priceBuy}}


percentOf и minusPercent (Работа с комиссиями)
В арбитраже мы постоянно считаем комиссии. Удобно иметь функцию, которая сразу отнимает процент от числа.

Суть: minusPercent(число, процент) возвращает число * (1 - процент/100).

Зачем: Чтобы показать реальную сумму, которая упадет на кошелек после перевода.

Пример в шаблоне:

Handlebars

Заходим на 1000$.
Комиссия сети (допустим 1%): -10$
Дойдет до биржи: {{minusPercent 1000 1}}$
4. min и max (Сравнение)
Иногда бот выдает несколько цен (например, цена продажи сейчас и цена продажи 5 минут назад). Тебе нужно подсветить лучшую или понять, упал спред или вырос.

Суть: Выбирает большее или меньшее из двух чисел.

Зачем: Для аналитики в сообщении ("Спред был 5%, стал 6% -> Лучший: 6%").

Пример в шаблоне:

Handlebars

Макс. просадка: {{max spreadPercent spreadPercentHistory}}%


1. multiply (Умножение) — Самое важное сейчас
Без этого ты не ответишь на свой вопрос "Сколько будет с 1000$".

Суть: Берет два числа и перемножает.

Пример использования: {{multiply spreadPercent 10}} (чтобы получить доход с 1000$, так как 1% от 1000 = 10).

2. formatNumber (Форматирование денег)
Твой round просто обрезает знаки, но не ставит запятые. Читать 1000000 сложно, а 1,000,000 — легко.

Суть: Разделяет тысячи пробелами или запятыми и фиксирует копейки.

Пример: Превращает 1234.5 в 1 234,50 $.

3. add и subtract (Плюс и Минус)
Пригодится, чтобы прямо в телеге показывать цены "с запасом" или учитывать комиссию сети.

Суть: Сложить или вычесть два числа.

Пример: Показать цену покупки чуть выше реальной (как бы с учетом проскальзывания): {{add priceBuy 0.001}}.

4. math (Универсальный калькулятор)
Это "Король хелперов". Вместо кучи отдельных функций (add, sub, mult) делают один мощный хелпер, который понимает строку.

Суть: Позволяет писать простые формулы прямо в шаблоне.

Пример: {{math "a * b - c"}} — сразу посчитать профит минус комсу. Если сможешь внедрить такой один — остальные не нужны.

5. abs (Модуль числа)
Для арбитража иногда спред бывает отрицательным (если смотреть обратную связку), но показать нужно разницу без минуса.

Суть: Убирает знак минус.